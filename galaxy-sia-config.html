<script type="text/javascript">
RED.nodes.registerType('galaxy-sia-config',{ 
    category: 'config',
    color: '#a6d7a8',
    defaults: {
        name:                   { value:"" },
        panelIP:               { value:"", required:true },
        panelPort:             { value:10002, required:true, validate:RED.validators.number() },
        account:               { value:"", required:true },
        siaLevel:              { value:4, required:true, validate:RED.validators.number() },
        encryption:            { value:false },
        encryptionKey:         { value:"" },
        encryptionHex:         { value:false },
        discardTestMessages:   { value:false },
        ackType:               { value:"SIA_PACKET" },
        ackCustom: { 
            value: "", 
            validate: function(v) { 
                return (this.ackType === "CUSTOM") ? v.trim().length > 0 : true; 
            }
        },
        periodicReportInterval: { value:0, required:true, validate:RED.validators.number() },
        pollingInterval:       { value:10, required:true, validate:RED.validators.number() },
        userId:                { value:"" },
        userCode:              { value:"" },
        heartbeatInterval:     { value:60, required:true, validate:RED.validators.number() },
        zoneMap:               { value:"" },
        userMap:               { value:"" },
        areaMap:               { value:"" },
        mapFile:               { value:"" },
        debug:                 { value:false }
    },
    credentials: {
        pin: { type: "password" }
    },
    inputs: 0,
    outputs: 0,
    icon: "font-awesome/fa-cog",
    label: function() {
        return this.name || this.panelIP || "galaxy-sia-config";
    },
    oneditprepare: function() {
        $("#node-input-panelPort").spinner({
            min:1,
            max:65535
        });
        $("#node-input-ackType").on("change", function() {
            if ($(this).val() === "CUSTOM") {
                $("#ack-custom-row").show();
            } else {
                $("#ack-custom-row").hide();
            }
        }).trigger("change");

        $("#node-input-siaLevel").spinner({ min:1, max:9 });
        $("#node-input-periodicReportInterval").spinner({ min:0 });
        $("#node-input-heartbeatInterval").spinner({ min:0 });
        $("#node-input-pollingInterval").spinner({ min:1, max:3600 });
    },
    oneditsave: function() {
        this.panelPort = parseInt(this.panelPort);
        this.siaLevel = parseInt(this.siaLevel);
        this.periodicReportInterval = parseInt(this.periodicReportInterval);
        this.heartbeatInterval = parseInt(this.heartbeatInterval);
        this.pollingInterval = parseInt(this.pollingInterval);
    }
});
</script>

<script type="text/html" data-template-name="galaxy-sia-config">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name">
    </div>
    <div class="form-row">
        <label for="node-config-input-panelIP"><i class="fa fa-globe"></i> Panel IP</label>
        <input type="text" id="node-config-input-panelIP">
    </div>
    <div class="form-row">
        <label for="node-config-input-panelPort"><i class="fa fa-random"></i> Panel Port</label>
        <input type="text" id="node-config-input-panelPort">
    </div>
    <div class="form-row">
        <label for="node-config-input-account"><i class="fa fa-id-card"></i> Account</label>
        <input type="text" id="node-config-input-account">
    </div>
    <div class="form-row">
        <label for="node-config-input-pin"><i class="fa fa-lock"></i> PIN</label>
        <input type="password" id="node-config-input-pin">
    </div>
    <div class="form-row">
        <label for="node-config-input-siaLevel"><i class="fa fa-level-up"></i> SIA Level</label>
        <input type="text" id="node-config-input-siaLevel">
    </div>
    <div class="form-row">
        <label for="node-config-input-encryption"><i class="fa fa-lock"></i> Encryption</label>
        <input type="checkbox" id="node-config-input-encryption" style="width: auto;">
    </div>
    <div class="form-row">
        <label for="node-config-input-encryptionKey"><i class="fa fa-key"></i> Encryption Key</label>
        <input type="password" id="node-config-input-encryptionKey">
    </div>
    <div class="form-row">
        <label for="node-config-input-encryptionHex"><i class="fa fa-code"></i> Key is HEX</label>
        <input type="checkbox" id="node-config-input-encryptionHex" style="width: auto;">
    </div>
    <div class="form-row">
        <label for="node-config-input-discardTestMessages"><i class="fa fa-filter"></i> Discard Test Msgs</label>
        <input type="checkbox" id="node-config-input-discardTestMessages" style="width: auto;">
    </div>
    <div class="form-row">
        <label for="node-config-input-ackType"><i class="fa fa-reply"></i> ACK Type</label>
        <select id="node-config-input-ackType">
            <option value="SIA_PACKET">SIA Packet</option>
            <option value="A_CRLF">A\r\n</option>
            <option value="A">A</option>
            <option value="ACK_CRLF">ACK\r\n</option>
            <option value="ACK">ACK</option>
            <option value="ECHO">Echo</option>
            <option value="ECHO_TRIM_END">Echo (trim end)</option>
            <option value="ECHO_STRIP_NONPRINT">Echo (strip non-print)</option>
            <option value="ECHO_TRIM_BOTH">Echo (trim both)</option>
            <option value="CUSTOM">Custom</option>
        </select>
    </div>
    <div class="form-row" id="ack-custom-row">
        <label for="node-config-input-ackCustom"><i class="fa fa-pencil"></i> Custom ACK</label>
        <input type="text" id="node-config-input-ackCustom">
    </div>
    <div class="form-row">
    <label for="node-config-input-ackCrcFormat"><i class="fa fa-shield"></i> ACK CRC Format</label>
    <select id="node-config-input-ackCrcFormat">
        <option value="hex">Hex (ASCII)</option>
        <option value="bin">Binární (2B)</option>
    </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-pollingType"><i class="fa fa-refresh"></i> Polling Type</label>
        <select id="node-config-input-pollingType">
            <option value="inquiry">Inquiry</option>
            <option value="heartbeat">Heartbeat</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-pollingInterval"><i class="fa fa-refresh"></i> Polling Interval</label>
        <input type="text" id="node-config-input-pollingInterval">
        <span class="units">seconds</span>
    </div>
    <div class="form-row">
        <label for="node-config-input-periodicReportInterval"><i class="fa fa-clock-o"></i> Report Interval</label>
        <input type="text" id="node-config-input-periodicReportInterval">
        <span class="units">seconds</span>
    </div>
    <div class="form-row">
        <label for="node-config-input-heartbeatInterval"><i class="fa fa-heartbeat"></i> Heartbeat</label>
        <input type="text" id="node-config-input-heartbeatInterval">
        <span class="units">seconds</span>
    </div>
    <div class="form-row">
        <label for="node-config-input-userId"><i class="fa fa-user"></i> User ID</label>
        <input type="text" id="node-config-input-userId">
    </div>
    <div class="form-row">
        <label for="node-config-input-userCode"><i class="fa fa-key"></i> User Code</label>
        <input type="text" id="node-config-input-userCode">
    </div>
    <div class="form-row">
        <label for="node-config-input-zoneMap"><i class="fa fa-map"></i> Zone Map</label>
        <input type="text" id="node-config-input-zoneMap" placeholder='{"1":"Zone 1","2":"Zone 2"}'>
    </div>
    <div class="form-row">
        <label for="node-config-input-userMap"><i class="fa fa-users"></i> User Map</label>
        <input type="text" id="node-config-input-userMap" placeholder='{"1":"User 1","2":"User 2"}'>
    </div>
    <div class="form-row">
        <label for="node-config-input-areaMap"><i class="fa fa-object-group"></i> Area Map</label>
        <input type="text" id="node-config-input-areaMap" placeholder='{"1":"Area 1","2":"Area 2"}'>
    </div>
    <div class="form-row">
        <label for="node-config-input-mapFile"><i class="fa fa-file-text-o"></i> Mapping File</label>
        <input type="text" id="node-config-input-mapFile">
    </div>
    <div class="form-row">
        <label for="node-config-input-debug"><i class="fa fa-bug"></i> Debug</label>
        <input type="checkbox" id="node-config-input-debug" style="width: auto;">
    </div>
</script>
